<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fixed Image with Movable Viewport</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: none;
        }
        
        body {
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        
        #viewport {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            transform-origin: 0 0;
            will-change: transform;
        }
        
        #background-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: none; /* Disables automatic resizing */
        }
        
        .debug-info {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px;
            border-radius: 4px;
            font-family: Arial, sans-serif;
            font-size: 12px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="viewport">
        <img id="background-image" src="deepseek_mermaid_20250809_596d87.jpg" alt="Document">
    </div>
    
    <div class="debug-info">
        Zoom: <span id="scale-display">1.00</span> | 
        Viewport: <span id="pos-display">0, 0</span>
    </div>

    <script>
        const viewport = document.getElementById('viewport');
        const img = document.getElementById('background-image');
        const scaleDisplay = document.getElementById('scale-display');
        const posDisplay = document.getElementById('pos-display');
        
        let scale = 1;
        let viewportX = 0;
        let viewportY = 0;
        let lastDist = 0;
        let isZooming = false;
        let imgWidth, imgHeight;
        
        // Initialize image and viewport
        function init() {
            img.onload = function() {
                imgWidth = img.naturalWidth;
                imgHeight = img.naturalHeight;
                
                // Set image dimensions (original size)
                img.style.width = imgWidth + 'px';
                img.style.height = imgHeight + 'px';
                
                resetViewport();
            };
        }
        
        // Reset viewport to initial state
        function resetViewport() {
            const containerWidth = window.innerWidth;
            const containerHeight = window.innerHeight;
            
            scale = Math.min(
                containerWidth / imgWidth,
                containerHeight / imgHeight
            );
            
            viewportX = (containerWidth - imgWidth * scale) / 2;
            viewportY = (containerHeight - imgHeight * scale) / 2;
            
            updateViewport();
        }
        
        // Update viewport transform
        function updateViewport() {
            viewport.style.transform = `
                translate(${viewportX}px, ${viewportY}px)
                scale(${scale})
            `;
            scaleDisplay.textContent = scale.toFixed(2);
            posDisplay.textContent = `${Math.round(viewportX)}, ${Math.round(viewportY)}`;
        }
        
        // Handle touch events for zooming
        viewport.addEventListener('touchstart', (e) => {
            if (e.touches.length === 2) {
                isZooming = true;
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                lastDist = Math.hypot(
                    touch2.clientX - touch1.clientX,
                    touch2.clientY - touch1.clientY
                );
            }
            e.preventDefault();
        });
        
        viewport.addEventListener('touchmove', (e) => {
            if (isZooming && e.touches.length === 2) {
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                const currentDist = Math.hypot(
                    touch2.clientX - touch1.clientX,
                    touch2.clientY - touch1.clientY
                );
                
                if (lastDist > 0) {
                    // Calculate new scale centered between fingers
                    const newScale = scale * (currentDist / lastDist);
                    scale = Math.max(0.5, Math.min(newScale, 5)); // Limit zoom range
                    
                    // Adjust viewport position to zoom toward center point
                    const centerX = (touch1.clientX + touch2.clientX) / 2;
                    const centerY = (touch1.clientY + touch2.clientY) / 2;
                    
                    viewportX = centerX - (centerX - viewportX) * (scale / (scale / (currentDist / lastDist)));
                    viewportY = centerY - (centerY - viewportY) * (scale / (scale / (currentDist / lastDist)));
                    
                    updateViewport();
                }
                lastDist = currentDist;
            }
            e.preventDefault();
        });
        
        viewport.addEventListener('touchend', (e) => {
            isZooming = false;
            lastDist = 0;
        });
        
        // Double-tap to reset
        viewport.addEventListener('touchend', (e) => {
            if (e.touches.length === 0 && e.changedTouches.length === 1) {
                const touch = e.changedTouches[0];
                const now = Date.now();
                if (touch.lastTap && (now - touch.lastTap) < 300) {
                    resetViewport();
                }
                touch.lastTap = now;
            }
        });
        
        // Handle window resize
        window.addEventListener('resize', resetViewport);
        
        // Initialize
        init();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protestant Missionary Tech Network</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        #flowchart {
            width: 100%;
            min-height: 600px;
            margin-bottom: 30px;
        }
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            z-index: 1000;
            max-width: 500px;
            width: 90%;
        }
        .popup h2 {
            color: #2c3e50;
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .popup-content {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        .popup-links a {
            display: block;
            margin-bottom: 8px;
            color: #3498db;
            text-decoration: none;
        }
        .popup-links a:hover {
            text-decoration: underline;
        }
        .close-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            float: right;
        }
        .close-btn:hover {
            background-color: #2980b9;
        }
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 999;
        }
        .node rect {
            cursor: pointer;
            transition: all 0.3s;
        }
        .node rect:hover {
            fill: #f0f8ff !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Protestant Missionary Technology Network</h1>
        <div id="flowchart"></div>
    </div>

    <div class="overlay" id="overlay"></div>

    <!-- Popups for each node -->
    <div class="popup" id="popup-A">
        <h2>Korean Christian Research Labs</h2>
        <div class="popup-content">
            Cutting-edge R&D centers funded by Korean megachurches to develop evangelical technologies.
        </div>
        <div class="popup-links">
            <a href="https://en.wikipedia.org/wiki/Christianity_in_Korea" target="_blank">Wikipedia: Christianity in Korea</a>
            <a href="https://www.christianitytoday.com/ct/2020/february-web-only/korea-christianity-research-development-missions.html" target="_blank">Christianity Today: Korean Mission Tech</a>
            <a href="https://www.koreatimes.co.kr/www/nation/2023/05/113_350079.html" target="_blank">Korea Times: Religious Tech Innovation</a>
        </div>
        <button class="close-btn" onclick="closePopup()">Close</button>
    </div>

    <!-- Other popups remain the same as before -->
    <!-- ... (include all other popup divs from the original code) ... -->

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            securityLevel: 'loose'
        });

        // Define the flowchart with explicit IDs
        const graphDefinition = `
            flowchart TD
                A["Korean Christian Research Labs"] --> B["Bible Translation AI"]
                A --> C["Digital Evangelism Tools"]
                B --> D["Real-Time Language AI"]
                B --> E["North Korean Dialect Support"]
                C --> F["VR Prayer Apps"]
                C --> G["Algorithmic Scripture Targeting"]
                D --> H["Underground USB Bibles"]
                E --> I["Sanction Circumvention"]
                F --> J["Gen Z Conversions"]
                G --> K["Social Media Integration"]

                class A,B,C,D,E,F,G,H,I,J,K clickable
                classDef clickable fill:#f9f9f9,stroke:#3498db,stroke-width:2px,cursor:pointer
        `;

        // Insert the flowchart
        document.getElementById('flowchart').innerHTML = graphDefinition;

        // Function to handle popups
        function showPopup(nodeId) {
            document.getElementById('overlay').style.display = 'block';
            document.getElementById(`popup-${nodeId}`).style.display = 'block';
        }

        function closePopup() {
            document.getElementById('overlay').style.display = 'none';
            document.querySelectorAll('.popup').forEach(popup => {
                popup.style.display = 'none';
            });
        }

        // Add click handlers after rendering
        function bindNodeClicks() {
            // Wait for Mermaid to render
            setTimeout(() => {
                const nodes = document.querySelectorAll('.node');
                
                nodes.forEach(node => {
                    // Get the text content and map to our node IDs
                    const text = node.querySelector('text')?.textContent.trim();
                    if (!text) return;
                    
                    // Simple mapping - first letter of each word
                    let nodeId = '';
                    if (text.includes('Korean Christian')) nodeId = 'A';
                    else if (text.includes('Bible Translation')) nodeId = 'B';
                    else if (text.includes('Digital Evangelism')) nodeId = 'C';
                    else if (text.includes('Real-Time Language')) nodeId = 'D';
                    else if (text.includes('North Korean Dialect')) nodeId = 'E';
                    else if (text.includes('VR Prayer')) nodeId = 'F';
                    else if (text.includes('Algorithmic Scripture')) nodeId = 'G';
                    else if (text.includes('Underground USB')) nodeId = 'H';
                    else if (text.includes('Sanction Circumvention')) nodeId = 'I';
                    else if (text.includes('Gen Z Conversions')) nodeId = 'J';
                    else if (text.includes('Social Media Integration')) nodeId = 'K';
                    
                    if (nodeId) {
                        node.style.cursor = 'pointer';
                        node.addEventListener('click', () => showPopup(nodeId));
                    }
                });
            }, 1000); // Longer delay to ensure rendering completes
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            // Re-render to apply changes
            mermaid.init(undefined, document.querySelectorAll('#flowchart'));
            
            // Bind click events
            bindNodeClicks();
        });

        // Close popup when clicking overlay
        document.getElementById('overlay').addEventListener('click', closePopup);
    </script>
</body>
</html>
